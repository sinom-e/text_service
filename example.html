<!DOCTYPE html>
<html>
<body>

<h1>Text Downloader</h1>

<p>Enter your text below, and click the button to download a text file.</p>

<input type="text" id="text" name="text">
<button onclick="sendRequest()">Get file</button>

<script>
	const downloadFile = (url) => {
		//create downloadable link and name it
		const link = document.createElement('a');
		link.href = url;
		link.download = 'textfile.txt';
		
		//add download link to DOM, simulate clicking it, and remove the link
		document.body.appendChild(link);
		link.click();
		document.body.removeChild(link);
	};

	const sendRequest = () => {
		//XML http boilerplate
		const xhr = new XMLHttpRequest();
		xhr.open('POST', 'http://localhost:3000/upload');
		xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
		xhr.onreadystatechange = () => {
			if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
				const fileUrl = xhr.responseText;
				downloadFile(fileUrl);
			}
		};
  
		//retrieve contents of text input element (id 'text' in this example)
		const text = document.getElementById('text').value;
  
		//send request
		xhr.send(JSON.stringify({ text: text }));
	};
</script>

</body>
</html>
